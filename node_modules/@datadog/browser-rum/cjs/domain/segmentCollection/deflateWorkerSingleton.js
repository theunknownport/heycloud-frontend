"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getDeflateWorkerSingleton = void 0;
var browser_core_1 = require("@datadog/browser-core");
var deflateWorker_1 = require("./deflateWorker");
var workerSingleton;
function getDeflateWorkerSingleton() {
    if (!workerSingleton) {
        try {
            workerSingleton = deflateWorker_1.createDeflateWorker();
        }
        catch (error) {
            browser_core_1.display.error('Session Replay recording failed to start: an error occurred while creating the Worker:', error);
            if (browser_core_1.includes(error.message, 'Content Security Policy')) {
                browser_core_1.display.error('Please make sure CSP is correctly configured ' +
                    'https://docs.datadoghq.com/real_user_monitoring/faq/content_security_policy');
            }
            else {
                browser_core_1.addErrorToMonitoringBatch(error);
            }
            return;
        }
        workerSingleton.addEventListener('message', browser_core_1.monitor(function (_a) {
            var data = _a.data;
            if ('error' in data) {
                browser_core_1.addErrorToMonitoringBatch(data.error);
            }
        }));
    }
    return workerSingleton;
}
exports.getDeflateWorkerSingleton = getDeflateWorkerSingleton;
//# sourceMappingURL=deflateWorkerSingleton.js.map