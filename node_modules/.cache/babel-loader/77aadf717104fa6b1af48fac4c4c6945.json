{"ast":null,"code":"import { monitor } from '../domain/internalMonitoring';\nexport var ONE_SECOND = 1000;\nexport var ONE_MINUTE = 60 * ONE_SECOND;\nexport var ONE_HOUR = 60 * ONE_MINUTE;\nexport var ONE_DAY = 24 * ONE_HOUR;\nexport var ONE_YEAR = 365 * ONE_DAY;\nexport var ONE_KILO_BYTE = 1024;\nexport var ResourceType;\n\n(function (ResourceType) {\n  ResourceType[\"DOCUMENT\"] = \"document\";\n  ResourceType[\"XHR\"] = \"xhr\";\n  ResourceType[\"BEACON\"] = \"beacon\";\n  ResourceType[\"FETCH\"] = \"fetch\";\n  ResourceType[\"CSS\"] = \"css\";\n  ResourceType[\"JS\"] = \"js\";\n  ResourceType[\"IMAGE\"] = \"image\";\n  ResourceType[\"FONT\"] = \"font\";\n  ResourceType[\"MEDIA\"] = \"media\";\n  ResourceType[\"OTHER\"] = \"other\";\n})(ResourceType || (ResourceType = {}));\n\nexport var RequestType;\n\n(function (RequestType) {\n  RequestType[\"FETCH\"] = \"fetch\";\n  RequestType[\"XHR\"] = \"xhr\";\n})(RequestType || (RequestType = {})); // use lodash API\n\n\nexport function throttle(fn, wait, options) {\n  var needLeadingExecution = options && options.leading !== undefined ? options.leading : true;\n  var needTrailingExecution = options && options.trailing !== undefined ? options.trailing : true;\n  var inWaitPeriod = false;\n  var pendingExecutionWithParameters;\n  var pendingTimeoutId;\n  return {\n    throttled: function () {\n      var parameters = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        parameters[_i] = arguments[_i];\n      }\n\n      if (inWaitPeriod) {\n        pendingExecutionWithParameters = parameters;\n        return;\n      }\n\n      if (needLeadingExecution) {\n        fn.apply(void 0, parameters);\n      } else {\n        pendingExecutionWithParameters = parameters;\n      }\n\n      inWaitPeriod = true;\n      pendingTimeoutId = setTimeout(function () {\n        if (needTrailingExecution && pendingExecutionWithParameters) {\n          fn.apply(void 0, pendingExecutionWithParameters);\n        }\n\n        inWaitPeriod = false;\n        pendingExecutionWithParameters = undefined;\n      }, wait);\n    },\n    cancel: function () {\n      clearTimeout(pendingTimeoutId);\n      inWaitPeriod = false;\n      pendingExecutionWithParameters = undefined;\n    }\n  };\n}\nexport function assign(target) {\n  var toAssign = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    toAssign[_i - 1] = arguments[_i];\n  }\n\n  toAssign.forEach(function (source) {\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  });\n}\n/**\n * UUID v4\n * from https://gist.github.com/jed/982883\n */\n\nexport function generateUUID(placeholder) {\n  return placeholder ? // eslint-disable-next-line  no-bitwise\n  (parseInt(placeholder, 10) ^ Math.random() * 16 >> parseInt(placeholder, 10) / 4).toString(16) : (1e7 + \"-\" + 1e3 + \"-\" + 4e3 + \"-\" + 8e3 + \"-\" + 1e11).replace(/[018]/g, generateUUID);\n}\n/**\n * Return true if the draw is successful\n * @param threshold between 0 and 100\n */\n\nexport function performDraw(threshold) {\n  return threshold !== 0 && Math.random() * 100 <= threshold;\n}\nexport function round(num, decimals) {\n  return +num.toFixed(decimals);\n} // eslint-disable-next-line @typescript-eslint/no-empty-function\n\nexport function noop() {}\n/**\n * Custom implementation of JSON.stringify that ignores value.toJSON.\n * We need to do that because some sites badly override toJSON on certain objects.\n * Note this still supposes that JSON.stringify is correct...\n */\n\nexport function jsonStringify(value, replacer, space) {\n  if (value === null || value === undefined) {\n    return JSON.stringify(value);\n  }\n\n  var originalToJSON = [false, undefined];\n\n  if (hasToJSON(value)) {\n    // We need to add a flag and not rely on the truthiness of value.toJSON\n    // because it can be set but undefined and that's actually significant.\n    originalToJSON = [true, value.toJSON];\n    delete value.toJSON;\n  }\n\n  var originalProtoToJSON = [false, undefined];\n  var prototype;\n\n  if (typeof value === 'object') {\n    prototype = Object.getPrototypeOf(value);\n\n    if (hasToJSON(prototype)) {\n      originalProtoToJSON = [true, prototype.toJSON];\n      delete prototype.toJSON;\n    }\n  }\n\n  var result;\n\n  try {\n    result = JSON.stringify(value, replacer, space);\n  } catch (_a) {\n    result = '<error: unable to serialize object>';\n  } finally {\n    if (originalToJSON[0]) {\n      ;\n      value.toJSON = originalToJSON[1];\n    }\n\n    if (originalProtoToJSON[0]) {\n      ;\n      prototype.toJSON = originalProtoToJSON[1];\n    }\n  }\n\n  return result;\n}\n\nfunction hasToJSON(value) {\n  return typeof value === 'object' && value !== null && value.hasOwnProperty('toJSON');\n}\n\nexport function includes(candidate, search) {\n  return candidate.indexOf(search) !== -1;\n}\nexport function find(array, predicate) {\n  for (var i = 0; i < array.length; i += 1) {\n    var item = array[i];\n\n    if (predicate(item, i, array)) {\n      return item;\n    }\n  }\n\n  return undefined;\n}\nexport function isPercentage(value) {\n  return isNumber(value) && value >= 0 && value <= 100;\n}\nexport function isNumber(value) {\n  return typeof value === 'number';\n}\nexport function objectValues(object) {\n  return Object.keys(object).map(function (key) {\n    return object[key];\n  });\n}\nexport function objectHasValue(object, value) {\n  return Object.keys(object).some(function (key) {\n    return object[key] === value;\n  });\n}\nexport function objectEntries(object) {\n  return Object.keys(object).map(function (key) {\n    return [key, object[key]];\n  });\n}\nexport function isEmptyObject(object) {\n  return Object.keys(object).length === 0;\n}\nexport function mapValues(object, fn) {\n  var newObject = {};\n\n  for (var _i = 0, _a = Object.keys(object); _i < _a.length; _i++) {\n    var key = _a[_i];\n    newObject[key] = fn(object[key]);\n  }\n\n  return newObject;\n}\n/**\n * inspired by https://mathiasbynens.be/notes/globalthis\n */\n\nexport function getGlobalObject() {\n  if (typeof globalThis === 'object') {\n    return globalThis;\n  }\n\n  Object.defineProperty(Object.prototype, '_dd_temp_', {\n    get: function () {\n      return this;\n    },\n    configurable: true\n  }); // @ts-ignore _dd_temp is defined using defineProperty\n\n  var globalObject = _dd_temp_; // @ts-ignore _dd_temp is defined using defineProperty\n\n  delete Object.prototype._dd_temp_;\n\n  if (typeof globalObject !== 'object') {\n    // on safari _dd_temp_ is available on window but not globally\n    // fallback on other browser globals check\n    if (typeof self === 'object') {\n      globalObject = self;\n    } else if (typeof window === 'object') {\n      globalObject = window;\n    } else {\n      globalObject = {};\n    }\n  }\n\n  return globalObject;\n}\nexport function getLocationOrigin() {\n  return getLinkElementOrigin(window.location);\n}\n/**\n * IE fallback\n * https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/origin\n */\n\nexport function getLinkElementOrigin(element) {\n  if (element.origin) {\n    return element.origin;\n  }\n\n  var sanitizedHost = element.host.replace(/(:80|:443)$/, '');\n  return element.protocol + \"//\" + sanitizedHost;\n}\nexport function findCommaSeparatedValue(rawString, name) {\n  var regex = new RegExp(\"(?:^|;)\\\\s*\" + name + \"\\\\s*=\\\\s*([^;]+)\");\n  var matches = regex.exec(rawString);\n  return matches ? matches[1] : undefined;\n}\nexport function safeTruncate(candidate, length) {\n  var lastChar = candidate.charCodeAt(length - 1); // check if it is the high part of a surrogate pair\n\n  if (lastChar >= 0xd800 && lastChar <= 0xdbff) {\n    return candidate.slice(0, length + 1);\n  }\n\n  return candidate.slice(0, length);\n}\n/**\n * Add an event listener to an event emitter object (Window, Element, mock object...).  This provides\n * a few conveniences compared to using `element.addEventListener` directly:\n *\n * * supports IE11 by: using an option object only if needed and emulating the `once` option\n *\n * * wraps the listener with a `monitor` function\n *\n * * returns a `stop` function to remove the listener\n */\n\nexport function addEventListener(emitter, event, listener, options) {\n  return addEventListeners(emitter, [event], listener, options);\n}\n/**\n * Add event listeners to an event emitter object (Window, Element, mock object...).  This provides\n * a few conveniences compared to using `element.addEventListener` directly:\n *\n * * supports IE11 by: using an option object only if needed and emulating the `once` option\n *\n * * wraps the listener with a `monitor` function\n *\n * * returns a `stop` function to remove the listener\n *\n * * with `once: true`, the listener will be called at most once, even if different events are listened\n */\n\nexport function addEventListeners(emitter, events, listener, _a) {\n  var _b = _a === void 0 ? {} : _a,\n      once = _b.once,\n      capture = _b.capture,\n      passive = _b.passive;\n\n  var wrappedListener = monitor(once ? function (event) {\n    stop();\n    listener(event);\n  } : listener);\n  var options = passive ? {\n    capture: capture,\n    passive: passive\n  } : capture;\n  events.forEach(function (event) {\n    return emitter.addEventListener(event, wrappedListener, options);\n  });\n\n  var stop = function () {\n    return events.forEach(function (event) {\n      return emitter.removeEventListener(event, wrappedListener, options);\n    });\n  };\n\n  return {\n    stop: stop\n  };\n}\nexport function runOnReadyState(expectedReadyState, callback) {\n  if (document.readyState === expectedReadyState || document.readyState === 'complete') {\n    callback();\n  } else {\n    var eventName = expectedReadyState === 'complete' ? \"load\"\n    /* LOAD */\n    : \"DOMContentLoaded\"\n    /* DOM_CONTENT_LOADED */\n    ;\n    addEventListener(window, eventName, callback, {\n      once: true\n    });\n  }\n}\n/**\n * Similar to `typeof`, but distinguish plain objects from `null` and arrays\n */\n\nexport function getType(value) {\n  if (value === null) {\n    return 'null';\n  }\n\n  if (Array.isArray(value)) {\n    return 'array';\n  }\n\n  return typeof value;\n}\n\nfunction createCircularReferenceChecker() {\n  if (typeof WeakSet !== 'undefined') {\n    var set_1 = new WeakSet();\n    return {\n      hasAlreadyBeenSeen: function (value) {\n        var has = set_1.has(value);\n\n        if (!has) {\n          set_1.add(value);\n        }\n\n        return has;\n      }\n    };\n  }\n\n  var array = [];\n  return {\n    hasAlreadyBeenSeen: function (value) {\n      var has = array.indexOf(value) >= 0;\n\n      if (!has) {\n        array.push(value);\n      }\n\n      return has;\n    }\n  };\n}\n/**\n * Iterate over source and affect its sub values into destination, recursively.\n * If the source and destination can't be merged, return source.\n */\n\n\nexport function mergeInto(destination, source, circularReferenceChecker) {\n  if (circularReferenceChecker === void 0) {\n    circularReferenceChecker = createCircularReferenceChecker();\n  } // ignore the source if it is undefined\n\n\n  if (source === undefined) {\n    return destination;\n  }\n\n  if (typeof source !== 'object' || source === null) {\n    // primitive values - just return source\n    return source;\n  } else if (source instanceof Date) {\n    return new Date(source.getTime());\n  } else if (source instanceof RegExp) {\n    var flags = source.flags || // old browsers compatibility\n    [source.global ? 'g' : '', source.ignoreCase ? 'i' : '', source.multiline ? 'm' : '', source.sticky ? 'y' : '', source.unicode ? 'u' : ''].join('');\n    return new RegExp(source.source, flags);\n  }\n\n  if (circularReferenceChecker.hasAlreadyBeenSeen(source)) {\n    // remove circular references\n    return undefined;\n  } else if (Array.isArray(source)) {\n    var merged_1 = Array.isArray(destination) ? destination : [];\n\n    for (var i = 0; i < source.length; ++i) {\n      merged_1[i] = mergeInto(merged_1[i], source[i], circularReferenceChecker);\n    }\n\n    return merged_1;\n  }\n\n  var merged = getType(destination) === 'object' ? destination : {};\n\n  for (var key in source) {\n    if (Object.prototype.hasOwnProperty.call(source, key)) {\n      merged[key] = mergeInto(merged[key], source[key], circularReferenceChecker);\n    }\n  }\n\n  return merged;\n}\n/**\n * A simplistic implementation of a deep clone algorithm.\n * Caveats:\n * - It doesn't maintain prototype chains - don't use with instances of custom classes.\n * - It doesn't handle Map and Set\n */\n\nexport function deepClone(value) {\n  return mergeInto(undefined, value);\n}\nexport function combine() {\n  var sources = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    sources[_i] = arguments[_i];\n  }\n\n  var destination;\n\n  for (var _a = 0, sources_1 = sources; _a < sources_1.length; _a++) {\n    var source = sources_1[_a]; // Ignore any undefined or null sources.\n\n    if (source === undefined || source === null) {\n      continue;\n    }\n\n    destination = mergeInto(destination, source);\n  }\n\n  return destination;\n}","map":{"version":3,"sources":["../../src/tools/utils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { monitor } from '../domain/internalMonitoring';\nexport var ONE_SECOND = 1000;\nexport var ONE_MINUTE = 60 * ONE_SECOND;\nexport var ONE_HOUR = 60 * ONE_MINUTE;\nexport var ONE_DAY = 24 * ONE_HOUR;\nexport var ONE_YEAR = 365 * ONE_DAY;\nexport var ONE_KILO_BYTE = 1024;\nexport var ResourceType;\n(function (ResourceType) {\n    ResourceType[\"DOCUMENT\"] = \"document\";\n    ResourceType[\"XHR\"] = \"xhr\";\n    ResourceType[\"BEACON\"] = \"beacon\";\n    ResourceType[\"FETCH\"] = \"fetch\";\n    ResourceType[\"CSS\"] = \"css\";\n    ResourceType[\"JS\"] = \"js\";\n    ResourceType[\"IMAGE\"] = \"image\";\n    ResourceType[\"FONT\"] = \"font\";\n    ResourceType[\"MEDIA\"] = \"media\";\n    ResourceType[\"OTHER\"] = \"other\";\n})(ResourceType || (ResourceType = {}));\nexport var RequestType;\n(function (RequestType) {\n    RequestType[\"FETCH\"] = \"fetch\";\n    RequestType[\"XHR\"] = \"xhr\";\n})(RequestType || (RequestType = {}));\n// use lodash API\nexport function throttle(fn, wait, options) {\n    var needLeadingExecution = options && options.leading !== undefined ? options.leading : true;\n    var needTrailingExecution = options && options.trailing !== undefined ? options.trailing : true;\n    var inWaitPeriod = false;\n    var pendingExecutionWithParameters;\n    var pendingTimeoutId;\n    return {\n        throttled: function () {\n            var parameters = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                parameters[_i] = arguments[_i];\n            }\n            if (inWaitPeriod) {\n                pendingExecutionWithParameters = parameters;\n                return;\n            }\n            if (needLeadingExecution) {\n                fn.apply(void 0, parameters);\n            }\n            else {\n                pendingExecutionWithParameters = parameters;\n            }\n            inWaitPeriod = true;\n            pendingTimeoutId = setTimeout(function () {\n                if (needTrailingExecution && pendingExecutionWithParameters) {\n                    fn.apply(void 0, pendingExecutionWithParameters);\n                }\n                inWaitPeriod = false;\n                pendingExecutionWithParameters = undefined;\n            }, wait);\n        },\n        cancel: function () {\n            clearTimeout(pendingTimeoutId);\n            inWaitPeriod = false;\n            pendingExecutionWithParameters = undefined;\n        },\n    };\n}\nexport function assign(target) {\n    var toAssign = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        toAssign[_i - 1] = arguments[_i];\n    }\n    toAssign.forEach(function (source) {\n        for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n                target[key] = source[key];\n            }\n        }\n    });\n}\n/**\n * UUID v4\n * from https://gist.github.com/jed/982883\n */\nexport function generateUUID(placeholder) {\n    return placeholder\n        ? // eslint-disable-next-line  no-bitwise\n            (parseInt(placeholder, 10) ^ ((Math.random() * 16) >> (parseInt(placeholder, 10) / 4))).toString(16)\n        : (1e7 + \"-\" + 1e3 + \"-\" + 4e3 + \"-\" + 8e3 + \"-\" + 1e11).replace(/[018]/g, generateUUID);\n}\n/**\n * Return true if the draw is successful\n * @param threshold between 0 and 100\n */\nexport function performDraw(threshold) {\n    return threshold !== 0 && Math.random() * 100 <= threshold;\n}\nexport function round(num, decimals) {\n    return +num.toFixed(decimals);\n}\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nexport function noop() { }\n/**\n * Custom implementation of JSON.stringify that ignores value.toJSON.\n * We need to do that because some sites badly override toJSON on certain objects.\n * Note this still supposes that JSON.stringify is correct...\n */\nexport function jsonStringify(value, replacer, space) {\n    if (value === null || value === undefined) {\n        return JSON.stringify(value);\n    }\n    var originalToJSON = [false, undefined];\n    if (hasToJSON(value)) {\n        // We need to add a flag and not rely on the truthiness of value.toJSON\n        // because it can be set but undefined and that's actually significant.\n        originalToJSON = [true, value.toJSON];\n        delete value.toJSON;\n    }\n    var originalProtoToJSON = [false, undefined];\n    var prototype;\n    if (typeof value === 'object') {\n        prototype = Object.getPrototypeOf(value);\n        if (hasToJSON(prototype)) {\n            originalProtoToJSON = [true, prototype.toJSON];\n            delete prototype.toJSON;\n        }\n    }\n    var result;\n    try {\n        result = JSON.stringify(value, replacer, space);\n    }\n    catch (_a) {\n        result = '<error: unable to serialize object>';\n    }\n    finally {\n        if (originalToJSON[0]) {\n            ;\n            value.toJSON = originalToJSON[1];\n        }\n        if (originalProtoToJSON[0]) {\n            ;\n            prototype.toJSON = originalProtoToJSON[1];\n        }\n    }\n    return result;\n}\nfunction hasToJSON(value) {\n    return typeof value === 'object' && value !== null && value.hasOwnProperty('toJSON');\n}\nexport function includes(candidate, search) {\n    return candidate.indexOf(search) !== -1;\n}\nexport function find(array, predicate) {\n    for (var i = 0; i < array.length; i += 1) {\n        var item = array[i];\n        if (predicate(item, i, array)) {\n            return item;\n        }\n    }\n    return undefined;\n}\nexport function isPercentage(value) {\n    return isNumber(value) && value >= 0 && value <= 100;\n}\nexport function isNumber(value) {\n    return typeof value === 'number';\n}\nexport function objectValues(object) {\n    return Object.keys(object).map(function (key) { return object[key]; });\n}\nexport function objectHasValue(object, value) {\n    return Object.keys(object).some(function (key) { return object[key] === value; });\n}\nexport function objectEntries(object) {\n    return Object.keys(object).map(function (key) { return [key, object[key]]; });\n}\nexport function isEmptyObject(object) {\n    return Object.keys(object).length === 0;\n}\nexport function mapValues(object, fn) {\n    var newObject = {};\n    for (var _i = 0, _a = Object.keys(object); _i < _a.length; _i++) {\n        var key = _a[_i];\n        newObject[key] = fn(object[key]);\n    }\n    return newObject;\n}\n/**\n * inspired by https://mathiasbynens.be/notes/globalthis\n */\nexport function getGlobalObject() {\n    if (typeof globalThis === 'object') {\n        return globalThis;\n    }\n    Object.defineProperty(Object.prototype, '_dd_temp_', {\n        get: function () {\n            return this;\n        },\n        configurable: true,\n    });\n    // @ts-ignore _dd_temp is defined using defineProperty\n    var globalObject = _dd_temp_;\n    // @ts-ignore _dd_temp is defined using defineProperty\n    delete Object.prototype._dd_temp_;\n    if (typeof globalObject !== 'object') {\n        // on safari _dd_temp_ is available on window but not globally\n        // fallback on other browser globals check\n        if (typeof self === 'object') {\n            globalObject = self;\n        }\n        else if (typeof window === 'object') {\n            globalObject = window;\n        }\n        else {\n            globalObject = {};\n        }\n    }\n    return globalObject;\n}\nexport function getLocationOrigin() {\n    return getLinkElementOrigin(window.location);\n}\n/**\n * IE fallback\n * https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/origin\n */\nexport function getLinkElementOrigin(element) {\n    if (element.origin) {\n        return element.origin;\n    }\n    var sanitizedHost = element.host.replace(/(:80|:443)$/, '');\n    return element.protocol + \"//\" + sanitizedHost;\n}\nexport function findCommaSeparatedValue(rawString, name) {\n    var regex = new RegExp(\"(?:^|;)\\\\s*\" + name + \"\\\\s*=\\\\s*([^;]+)\");\n    var matches = regex.exec(rawString);\n    return matches ? matches[1] : undefined;\n}\nexport function safeTruncate(candidate, length) {\n    var lastChar = candidate.charCodeAt(length - 1);\n    // check if it is the high part of a surrogate pair\n    if (lastChar >= 0xd800 && lastChar <= 0xdbff) {\n        return candidate.slice(0, length + 1);\n    }\n    return candidate.slice(0, length);\n}\n/**\n * Add an event listener to an event emitter object (Window, Element, mock object...).  This provides\n * a few conveniences compared to using `element.addEventListener` directly:\n *\n * * supports IE11 by: using an option object only if needed and emulating the `once` option\n *\n * * wraps the listener with a `monitor` function\n *\n * * returns a `stop` function to remove the listener\n */\nexport function addEventListener(emitter, event, listener, options) {\n    return addEventListeners(emitter, [event], listener, options);\n}\n/**\n * Add event listeners to an event emitter object (Window, Element, mock object...).  This provides\n * a few conveniences compared to using `element.addEventListener` directly:\n *\n * * supports IE11 by: using an option object only if needed and emulating the `once` option\n *\n * * wraps the listener with a `monitor` function\n *\n * * returns a `stop` function to remove the listener\n *\n * * with `once: true`, the listener will be called at most once, even if different events are listened\n */\nexport function addEventListeners(emitter, events, listener, _a) {\n    var _b = _a === void 0 ? {} : _a, once = _b.once, capture = _b.capture, passive = _b.passive;\n    var wrappedListener = monitor(once\n        ? function (event) {\n            stop();\n            listener(event);\n        }\n        : listener);\n    var options = passive ? { capture: capture, passive: passive } : capture;\n    events.forEach(function (event) { return emitter.addEventListener(event, wrappedListener, options); });\n    var stop = function () { return events.forEach(function (event) { return emitter.removeEventListener(event, wrappedListener, options); }); };\n    return {\n        stop: stop,\n    };\n}\nexport function runOnReadyState(expectedReadyState, callback) {\n    if (document.readyState === expectedReadyState || document.readyState === 'complete') {\n        callback();\n    }\n    else {\n        var eventName = expectedReadyState === 'complete' ? \"load\" /* LOAD */ : \"DOMContentLoaded\" /* DOM_CONTENT_LOADED */;\n        addEventListener(window, eventName, callback, { once: true });\n    }\n}\n/**\n * Similar to `typeof`, but distinguish plain objects from `null` and arrays\n */\nexport function getType(value) {\n    if (value === null) {\n        return 'null';\n    }\n    if (Array.isArray(value)) {\n        return 'array';\n    }\n    return typeof value;\n}\nfunction createCircularReferenceChecker() {\n    if (typeof WeakSet !== 'undefined') {\n        var set_1 = new WeakSet();\n        return {\n            hasAlreadyBeenSeen: function (value) {\n                var has = set_1.has(value);\n                if (!has) {\n                    set_1.add(value);\n                }\n                return has;\n            },\n        };\n    }\n    var array = [];\n    return {\n        hasAlreadyBeenSeen: function (value) {\n            var has = array.indexOf(value) >= 0;\n            if (!has) {\n                array.push(value);\n            }\n            return has;\n        },\n    };\n}\n/**\n * Iterate over source and affect its sub values into destination, recursively.\n * If the source and destination can't be merged, return source.\n */\nexport function mergeInto(destination, source, circularReferenceChecker) {\n    if (circularReferenceChecker === void 0) { circularReferenceChecker = createCircularReferenceChecker(); }\n    // ignore the source if it is undefined\n    if (source === undefined) {\n        return destination;\n    }\n    if (typeof source !== 'object' || source === null) {\n        // primitive values - just return source\n        return source;\n    }\n    else if (source instanceof Date) {\n        return new Date(source.getTime());\n    }\n    else if (source instanceof RegExp) {\n        var flags = source.flags ||\n            // old browsers compatibility\n            [\n                source.global ? 'g' : '',\n                source.ignoreCase ? 'i' : '',\n                source.multiline ? 'm' : '',\n                source.sticky ? 'y' : '',\n                source.unicode ? 'u' : '',\n            ].join('');\n        return new RegExp(source.source, flags);\n    }\n    if (circularReferenceChecker.hasAlreadyBeenSeen(source)) {\n        // remove circular references\n        return undefined;\n    }\n    else if (Array.isArray(source)) {\n        var merged_1 = Array.isArray(destination) ? destination : [];\n        for (var i = 0; i < source.length; ++i) {\n            merged_1[i] = mergeInto(merged_1[i], source[i], circularReferenceChecker);\n        }\n        return merged_1;\n    }\n    var merged = getType(destination) === 'object' ? destination : {};\n    for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n            merged[key] = mergeInto(merged[key], source[key], circularReferenceChecker);\n        }\n    }\n    return merged;\n}\n/**\n * A simplistic implementation of a deep clone algorithm.\n * Caveats:\n * - It doesn't maintain prototype chains - don't use with instances of custom classes.\n * - It doesn't handle Map and Set\n */\nexport function deepClone(value) {\n    return mergeInto(undefined, value);\n}\nexport function combine() {\n    var sources = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        sources[_i] = arguments[_i];\n    }\n    var destination;\n    for (var _a = 0, sources_1 = sources; _a < sources_1.length; _a++) {\n        var source = sources_1[_a];\n        // Ignore any undefined or null sources.\n        if (source === undefined || source === null) {\n            continue;\n        }\n        destination = mergeInto(destination, source);\n    }\n    return destination;\n}\n//# sourceMappingURL=utils.js.map"]},"metadata":{},"sourceType":"module"}