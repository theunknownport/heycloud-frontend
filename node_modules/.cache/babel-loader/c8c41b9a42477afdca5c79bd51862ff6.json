{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { RecordType } from '../../types';\nimport { serializeDocument } from './serialize';\nimport { initObservers } from './observer';\nimport { IncrementalSource } from './types';\nimport { getWindowHeight, getWindowWidth } from './utils';\nimport { MutationController } from './mutationObserver';\nexport function record(options) {\n  var emit = options.emit; // runtime checks for user options\n\n  if (!emit) {\n    throw new Error('emit function is required');\n  }\n\n  var mutationController = new MutationController();\n\n  var takeFullSnapshot = function () {\n    var _a, _b, _c, _d;\n\n    mutationController.flush(); // process any pending mutation before taking a full snapshot\n\n    emit({\n      data: {\n        height: getWindowHeight(),\n        href: window.location.href,\n        width: getWindowWidth()\n      },\n      type: RecordType.Meta\n    });\n    emit({\n      data: {\n        has_focus: document.hasFocus()\n      },\n      type: RecordType.Focus\n    });\n    emit({\n      data: {\n        node: serializeDocument(document, options.defaultPrivacyLevel),\n        initialOffset: {\n          left: window.pageXOffset !== undefined ? window.pageXOffset : (document === null || document === void 0 ? void 0 : document.documentElement.scrollLeft) || ((_b = (_a = document === null || document === void 0 ? void 0 : document.body) === null || _a === void 0 ? void 0 : _a.parentElement) === null || _b === void 0 ? void 0 : _b.scrollLeft) || (document === null || document === void 0 ? void 0 : document.body.scrollLeft) || 0,\n          top: window.pageYOffset !== undefined ? window.pageYOffset : (document === null || document === void 0 ? void 0 : document.documentElement.scrollTop) || ((_d = (_c = document === null || document === void 0 ? void 0 : document.body) === null || _c === void 0 ? void 0 : _c.parentElement) === null || _d === void 0 ? void 0 : _d.scrollTop) || (document === null || document === void 0 ? void 0 : document.body.scrollTop) || 0\n        }\n      },\n      type: RecordType.FullSnapshot\n    });\n  };\n\n  takeFullSnapshot();\n  var stopObservers = initObservers({\n    mutationController: mutationController,\n    defaultPrivacyLevel: options.defaultPrivacyLevel,\n    inputCb: function (v) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.Input\n        }, v),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    mediaInteractionCb: function (p) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.MediaInteraction\n        }, p),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    mouseInteractionCb: function (d) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.MouseInteraction\n        }, d),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    mousemoveCb: function (positions, source) {\n      return emit({\n        data: {\n          positions: positions,\n          source: source\n        },\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    mutationCb: function (m) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.Mutation\n        }, m),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    scrollCb: function (p) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.Scroll\n        }, p),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    styleSheetRuleCb: function (r) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.StyleSheetRule\n        }, r),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    viewportResizeCb: function (d) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.ViewportResize\n        }, d),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    focusCb: function (data) {\n      return emit({\n        type: RecordType.Focus,\n        data: data\n      });\n    }\n  });\n  return {\n    stop: stopObservers,\n    takeFullSnapshot: takeFullSnapshot,\n    flushMutations: function () {\n      return mutationController.flush();\n    }\n  };\n}","map":{"version":3,"sources":["../../../src/domain/record/record.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign } from \"tslib\";\nimport { RecordType } from '../../types';\nimport { serializeDocument } from './serialize';\nimport { initObservers } from './observer';\nimport { IncrementalSource } from './types';\nimport { getWindowHeight, getWindowWidth } from './utils';\nimport { MutationController } from './mutationObserver';\nexport function record(options) {\n    var emit = options.emit;\n    // runtime checks for user options\n    if (!emit) {\n        throw new Error('emit function is required');\n    }\n    var mutationController = new MutationController();\n    var takeFullSnapshot = function () {\n        var _a, _b, _c, _d;\n        mutationController.flush(); // process any pending mutation before taking a full snapshot\n        emit({\n            data: {\n                height: getWindowHeight(),\n                href: window.location.href,\n                width: getWindowWidth(),\n            },\n            type: RecordType.Meta,\n        });\n        emit({\n            data: {\n                has_focus: document.hasFocus(),\n            },\n            type: RecordType.Focus,\n        });\n        emit({\n            data: {\n                node: serializeDocument(document, options.defaultPrivacyLevel),\n                initialOffset: {\n                    left: window.pageXOffset !== undefined\n                        ? window.pageXOffset\n                        : (document === null || document === void 0 ? void 0 : document.documentElement.scrollLeft) || ((_b = (_a = document === null || document === void 0 ? void 0 : document.body) === null || _a === void 0 ? void 0 : _a.parentElement) === null || _b === void 0 ? void 0 : _b.scrollLeft) || (document === null || document === void 0 ? void 0 : document.body.scrollLeft) ||\n                            0,\n                    top: window.pageYOffset !== undefined\n                        ? window.pageYOffset\n                        : (document === null || document === void 0 ? void 0 : document.documentElement.scrollTop) || ((_d = (_c = document === null || document === void 0 ? void 0 : document.body) === null || _c === void 0 ? void 0 : _c.parentElement) === null || _d === void 0 ? void 0 : _d.scrollTop) || (document === null || document === void 0 ? void 0 : document.body.scrollTop) ||\n                            0,\n                },\n            },\n            type: RecordType.FullSnapshot,\n        });\n    };\n    takeFullSnapshot();\n    var stopObservers = initObservers({\n        mutationController: mutationController,\n        defaultPrivacyLevel: options.defaultPrivacyLevel,\n        inputCb: function (v) {\n            return emit({\n                data: __assign({ source: IncrementalSource.Input }, v),\n                type: RecordType.IncrementalSnapshot,\n            });\n        },\n        mediaInteractionCb: function (p) {\n            return emit({\n                data: __assign({ source: IncrementalSource.MediaInteraction }, p),\n                type: RecordType.IncrementalSnapshot,\n            });\n        },\n        mouseInteractionCb: function (d) {\n            return emit({\n                data: __assign({ source: IncrementalSource.MouseInteraction }, d),\n                type: RecordType.IncrementalSnapshot,\n            });\n        },\n        mousemoveCb: function (positions, source) {\n            return emit({\n                data: {\n                    positions: positions,\n                    source: source,\n                },\n                type: RecordType.IncrementalSnapshot,\n            });\n        },\n        mutationCb: function (m) {\n            return emit({\n                data: __assign({ source: IncrementalSource.Mutation }, m),\n                type: RecordType.IncrementalSnapshot,\n            });\n        },\n        scrollCb: function (p) {\n            return emit({\n                data: __assign({ source: IncrementalSource.Scroll }, p),\n                type: RecordType.IncrementalSnapshot,\n            });\n        },\n        styleSheetRuleCb: function (r) {\n            return emit({\n                data: __assign({ source: IncrementalSource.StyleSheetRule }, r),\n                type: RecordType.IncrementalSnapshot,\n            });\n        },\n        viewportResizeCb: function (d) {\n            return emit({\n                data: __assign({ source: IncrementalSource.ViewportResize }, d),\n                type: RecordType.IncrementalSnapshot,\n            });\n        },\n        focusCb: function (data) {\n            return emit({\n                type: RecordType.Focus,\n                data: data,\n            });\n        },\n    });\n    return {\n        stop: stopObservers,\n        takeFullSnapshot: takeFullSnapshot,\n        flushMutations: function () { return mutationController.flush(); },\n    };\n}\n//# sourceMappingURL=record.js.map"]},"metadata":{},"sourceType":"module"}