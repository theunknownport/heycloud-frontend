{"ast":null,"code":"import { addErrorToMonitoringBatch, display, includes, monitor } from '@datadog/browser-core';\nimport { createDeflateWorker } from './deflateWorker';\nvar workerSingleton;\nexport function getDeflateWorkerSingleton() {\n  if (!workerSingleton) {\n    try {\n      workerSingleton = createDeflateWorker();\n    } catch (error) {\n      display.error('Session Replay recording failed to start: an error occurred while creating the Worker:', error);\n\n      if (includes(error.message, 'Content Security Policy')) {\n        display.error('Please make sure CSP is correctly configured ' + 'https://docs.datadoghq.com/real_user_monitoring/faq/content_security_policy');\n      } else {\n        addErrorToMonitoringBatch(error);\n      }\n\n      return;\n    }\n\n    workerSingleton.addEventListener('message', monitor(function (_a) {\n      var data = _a.data;\n\n      if ('error' in data) {\n        addErrorToMonitoringBatch(data.error);\n      }\n    }));\n  }\n\n  return workerSingleton;\n}","map":{"version":3,"sources":["../../../src/domain/segmentCollection/deflateWorkerSingleton.ts"],"names":[],"mappings":"AAAA,SAAS,yBAAT,EAAoC,OAApC,EAA6C,QAA7C,EAAuD,OAAvD,QAAsE,uBAAtE;AACA,SAAS,mBAAT,QAAmD,iBAAnD;AAEA,IAAI,eAAJ;AAEA,OAAM,SAAU,yBAAV,GAAmC;AACvC,MAAI,CAAC,eAAL,EAAsB;AACpB,QAAI;AACF,MAAA,eAAe,GAAG,mBAAmB,EAArC;AACD,KAFD,CAEE,OAAO,KAAP,EAAc;AACd,MAAA,OAAO,CAAC,KAAR,CAAc,wFAAd,EAAwG,KAAxG;;AACA,UAAI,QAAQ,CAAC,KAAK,CAAC,OAAP,EAAgB,yBAAhB,CAAZ,EAAwD;AACtD,QAAA,OAAO,CAAC,KAAR,CACE,kDACE,6EAFJ;AAID,OALD,MAKO;AACL,QAAA,yBAAyB,CAAC,KAAD,CAAzB;AACD;;AACD;AACD;;AACD,IAAA,eAAe,CAAC,gBAAhB,CACE,SADF,EAEE,OAAO,CAAC,UAAC,EAAD,EAAS;UAAN,IAAI,GAAA,EAAA,CAAA,I;;AACb,UAAI,WAAW,IAAf,EAAqB;AACnB,QAAA,yBAAyB,CAAC,IAAI,CAAC,KAAN,CAAzB;AACD;AACF,KAJM,CAFT;AAQD;;AACD,SAAO,eAAP;AACD","sourceRoot":"","sourcesContent":["import { addErrorToMonitoringBatch, display, includes, monitor } from '@datadog/browser-core';\nimport { createDeflateWorker } from './deflateWorker';\nvar workerSingleton;\nexport function getDeflateWorkerSingleton() {\n    if (!workerSingleton) {\n        try {\n            workerSingleton = createDeflateWorker();\n        }\n        catch (error) {\n            display.error('Session Replay recording failed to start: an error occurred while creating the Worker:', error);\n            if (includes(error.message, 'Content Security Policy')) {\n                display.error('Please make sure CSP is correctly configured ' +\n                    'https://docs.datadoghq.com/real_user_monitoring/faq/content_security_policy');\n            }\n            else {\n                addErrorToMonitoringBatch(error);\n            }\n            return;\n        }\n        workerSingleton.addEventListener('message', monitor(function (_a) {\n            var data = _a.data;\n            if ('error' in data) {\n                addErrorToMonitoringBatch(data.error);\n            }\n        }));\n    }\n    return workerSingleton;\n}\n//# sourceMappingURL=deflateWorkerSingleton.js.map"]},"metadata":{},"sourceType":"module"}