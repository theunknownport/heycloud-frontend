{"ast":null,"code":"export var MAX_STATS_HISTORY = 10;\nvar statsPerView;\nexport function addSegment(viewId) {\n  getOrCreateReplayStats(viewId).segments_count += 1;\n}\nexport function addRecord(viewId) {\n  getOrCreateReplayStats(viewId).records_count += 1;\n}\nexport function addWroteData(viewId, additionalRawSize) {\n  getOrCreateReplayStats(viewId).segments_total_raw_size += additionalRawSize;\n}\nexport function getReplayStats(viewId) {\n  return statsPerView === null || statsPerView === void 0 ? void 0 : statsPerView.get(viewId);\n}\nexport function resetReplayStats() {\n  statsPerView = undefined;\n}\n\nfunction getOrCreateReplayStats(viewId) {\n  if (!statsPerView) {\n    statsPerView = new Map();\n  }\n\n  var replayStats;\n\n  if (statsPerView.has(viewId)) {\n    replayStats = statsPerView.get(viewId);\n  } else {\n    replayStats = {\n      records_count: 0,\n      segments_count: 0,\n      segments_total_raw_size: 0\n    };\n    statsPerView.set(viewId, replayStats);\n\n    if (statsPerView.size > MAX_STATS_HISTORY) {\n      deleteOldestStats();\n    }\n  }\n\n  return replayStats;\n}\n\nfunction deleteOldestStats() {\n  if (!statsPerView) {\n    return;\n  }\n\n  if (statsPerView.keys) {\n    statsPerView.delete(statsPerView.keys().next().value);\n  } else {\n    // IE11 doesn't support map.keys\n    var isFirst_1 = true;\n    statsPerView.forEach(function (_value, key) {\n      if (isFirst_1) {\n        statsPerView.delete(key);\n        isFirst_1 = false;\n      }\n    });\n  }\n}","map":{"version":3,"sources":["../../src/domain/replayStats.ts"],"names":[],"mappings":"AAEA,OAAO,IAAM,iBAAiB,GAAG,EAA1B;AACP,IAAI,YAAJ;AAEA,OAAM,SAAU,UAAV,CAAqB,MAArB,EAAmC;AACvC,EAAA,sBAAsB,CAAC,MAAD,CAAtB,CAA+B,cAA/B,IAAiD,CAAjD;AACD;AAED,OAAM,SAAU,SAAV,CAAoB,MAApB,EAAkC;AACtC,EAAA,sBAAsB,CAAC,MAAD,CAAtB,CAA+B,aAA/B,IAAgD,CAAhD;AACD;AAED,OAAM,SAAU,YAAV,CAAuB,MAAvB,EAAuC,iBAAvC,EAAgE;AACpE,EAAA,sBAAsB,CAAC,MAAD,CAAtB,CAA+B,uBAA/B,IAA0D,iBAA1D;AACD;AAED,OAAM,SAAU,cAAV,CAAyB,MAAzB,EAAuC;AAC3C,SAAO,YAAY,KAAA,IAAZ,IAAA,YAAY,KAAA,KAAA,CAAZ,GAAY,KAAA,CAAZ,GAAA,YAAY,CAAE,GAAd,CAAkB,MAAlB,CAAP;AACD;AAED,OAAM,SAAU,gBAAV,GAA0B;AAC9B,EAAA,YAAY,GAAG,SAAf;AACD;;AAED,SAAS,sBAAT,CAAgC,MAAhC,EAA8C;AAC5C,MAAI,CAAC,YAAL,EAAmB;AACjB,IAAA,YAAY,GAAG,IAAI,GAAJ,EAAf;AACD;;AAED,MAAI,WAAJ;;AACA,MAAI,YAAY,CAAC,GAAb,CAAiB,MAAjB,CAAJ,EAA8B;AAC5B,IAAA,WAAW,GAAG,YAAY,CAAC,GAAb,CAAiB,MAAjB,CAAd;AACD,GAFD,MAEO;AACL,IAAA,WAAW,GAAG;AACZ,MAAA,aAAa,EAAE,CADH;AAEZ,MAAA,cAAc,EAAE,CAFJ;AAGZ,MAAA,uBAAuB,EAAE;AAHb,KAAd;AAKA,IAAA,YAAY,CAAC,GAAb,CAAiB,MAAjB,EAAyB,WAAzB;;AACA,QAAI,YAAY,CAAC,IAAb,GAAoB,iBAAxB,EAA2C;AACzC,MAAA,iBAAiB;AAClB;AACF;;AAED,SAAO,WAAP;AACD;;AAED,SAAS,iBAAT,GAA0B;AACxB,MAAI,CAAC,YAAL,EAAmB;AACjB;AACD;;AACD,MAAI,YAAY,CAAC,IAAjB,EAAuB;AACrB,IAAA,YAAY,CAAC,MAAb,CAAoB,YAAY,CAAC,IAAb,GAAoB,IAApB,GAA2B,KAA/C;AACD,GAFD,MAEO;AACL;AACA,QAAI,SAAO,GAAG,IAAd;AACA,IAAA,YAAY,CAAC,OAAb,CAAqB,UAAC,MAAD,EAAS,GAAT,EAAY;AAC/B,UAAI,SAAJ,EAAa;AACX,QAAA,YAAa,CAAC,MAAd,CAAqB,GAArB;AACA,QAAA,SAAO,GAAG,KAAV;AACD;AACF,KALD;AAMD;AACF","sourceRoot":"","sourcesContent":["export var MAX_STATS_HISTORY = 10;\nvar statsPerView;\nexport function addSegment(viewId) {\n    getOrCreateReplayStats(viewId).segments_count += 1;\n}\nexport function addRecord(viewId) {\n    getOrCreateReplayStats(viewId).records_count += 1;\n}\nexport function addWroteData(viewId, additionalRawSize) {\n    getOrCreateReplayStats(viewId).segments_total_raw_size += additionalRawSize;\n}\nexport function getReplayStats(viewId) {\n    return statsPerView === null || statsPerView === void 0 ? void 0 : statsPerView.get(viewId);\n}\nexport function resetReplayStats() {\n    statsPerView = undefined;\n}\nfunction getOrCreateReplayStats(viewId) {\n    if (!statsPerView) {\n        statsPerView = new Map();\n    }\n    var replayStats;\n    if (statsPerView.has(viewId)) {\n        replayStats = statsPerView.get(viewId);\n    }\n    else {\n        replayStats = {\n            records_count: 0,\n            segments_count: 0,\n            segments_total_raw_size: 0,\n        };\n        statsPerView.set(viewId, replayStats);\n        if (statsPerView.size > MAX_STATS_HISTORY) {\n            deleteOldestStats();\n        }\n    }\n    return replayStats;\n}\nfunction deleteOldestStats() {\n    if (!statsPerView) {\n        return;\n    }\n    if (statsPerView.keys) {\n        statsPerView.delete(statsPerView.keys().next().value);\n    }\n    else {\n        // IE11 doesn't support map.keys\n        var isFirst_1 = true;\n        statsPerView.forEach(function (_value, key) {\n            if (isFirst_1) {\n                statsPerView.delete(key);\n                isFirst_1 = false;\n            }\n        });\n    }\n}\n//# sourceMappingURL=replayStats.js.map"]},"metadata":{},"sourceType":"module"}